---
title: How to configure a waiting room through Azion Marketplace
description: Manage traffic surges and prevent overload on your websites and applications using a waiting room. 
meta_tags: edge firewall, marketplace, security, integrations
namespace: docs_guides_waiting_room
permalink: /documentation/products/guides/waiting-room/
---

**Upstash Waiting Room** is an integration that helps you manage traffic surges and prevent overload on your websites and applications. The integration uses a *First-In, First-Out (FIFO)* approach and leverages on Azion **Edge Firewall**, creating a waiting room to control and redirect access according to your parameters. The waiting room implementation also uses *Redis* as a state store.

---

## How the integration works

When a request is received by your website, Edge Firewall executes the integration. It checks if there's available space to enter on the website and generates a "ticket" (or unique identifier) for the request, saved as a cookie in the user's session. All tickets are included on Redis with a TTL and are configured to be removed when they expire. The waiting queue in the Redis register is a FIFO (First In, First Out) list without any TTL.

For each request, the integration verifies if there's available space and moves the tickets from the waiting queue to the release queue. If the ticket was on the release queue, the integration liberates the access. If there isn't availability, the request is redirected to the waiting room, receiving a number in the row to access.

---

## Requirements

To start using this integration, you need to:

- Create an [Upstash account](https://console.upstash.com/login).
- Create a Global Database for the best available edge latency in the [Upstash Console](https://console.upstash.com/).

---

## Getting the integration

To install this integration:

1. Access [Real-Time Manager (RTM)](/en/documentation/products/guides/how-to-access-rtm/) > **Marketplace**.
2. On the Marketplace homepage, select the **Waiting Room** card.
3. On the integration page, click the **Get It Now** button, located at the bottom-right corner of the page.

You'll see a message indicating that your integration was successfully installed.

:::tip
You can search any integration by browsing through the cards or typing a keyword in the search bar.
:::

---

## Configuring the integration

Once you've installed the **Waiting Room** integration, you'll need to complete the steps explained below to instantiate the function and configure a rule set.

### Setting up the Edge Firewall rule

To instantiate the **Waiting Room** integration, follow the steps:

1. On the upper-left corner, select **Products menu** and select **Edge Firewall** in the **SECURE** section.
2. Click the **Add Rule Set** button.
3. Give an easy-to-remember name to your new rule.
4. Select the domains you want to protect with the function.
5. Enable the **Edge Functions** switch in the **Edge Firewall Modules**.
- This action gives access to edge functions on your edge firewall.
6. Click the **Save** button.

Done. Now you've instantiated the rule for your function and have access to edge functions on your edge firewall.

:::caution[Warning]
If a product or module is activated, it could generate usage-related costs. Check the [pricing page](https://www.azion.com/en/pricing/) for more information.
:::

### Setting up the Edge Firewall function

While still on the **Edge Firewall** page, select the **Functions** tab and follow these steps:

1. Click the **Add Function** button.
2. Give an easy-to-remember name to your instance.
3. On the dropdown menu, select the **Waiting Room** function.

This action will load the function, showing a form with the function's source-code and two tabs: **Code** and **Args**. By clicking on the **Code** tab, you'll be able to navigate through the source-code, but won't be able to change it.

4. In the **Args** tab, you'll pass your Upstash credentials and your variables:

```json
{
  "url": "https://region-database.upstash.io",
  "token": "YourUpstashToken",
  "ttl": 10,
  "capacity": 2
}
```

Where:

| Variable | Mandatory | Description |
| ---- | ---- | ---- |
| `url` | Yes | URL string to connect on Upstash Redis. Go to your Upstash Console and copy the `UPSTASH_REDIS_REST_URL` in your database page |
| `token` | Yes | Token to access the Upstash Redis database. Go to your Upstash Console and copy the `UPSTASH_REDIS_REST_TOKEN` in your database page |
| `ttl` | Yes | Maximum time, in seconds, that a user can stay on your website. Example: `180` |
| `capacity` | Yes | Maximum number of simultaneous connections allowed on your website. Example: `10` |

:::tip
You can monitor the activity through the **Upstash Dashboard**
:::

### Setting up the Rules Engine

To finish, you have to set up a rule in **Rules Engine** to configure the **criteria** and the **behavior** to run the function.

Still in the **Edge Firewall** page:

1. Select the **Rules Engine** tab.
2. Click the **New Rule** button.
3. Give an easy-to-remember name to the rule.
4. Select a *criteria* to run and catch the domains that you want to run the integration on. Example: `xyz insert here`.
5. Below, select the **Run Function** *behavior* to the *criteria*.
6. Select the **Waiting Room** function according to the name you gave it before.
7. Click the **Save** button.

Done. Now the **Waiting Room** integration is running.

---

## Customizing your waiting room

### Customizing the message

The redirect action of this integration leads to a simple `.html` interface with a basic message. In case you want to create a more personalized experience, you can edit the basic message included in the `.html` file.

To do so:

1. 
2. 
3.

### Customizing the interface

Redirect your users to a custommized interfaced. To do so, add the `waiting_room_html` variable while [setting up the Edge Firewall function](#setting-up-the-edge-firewall-function), as follows:

```json
{
  "waiting_room_html": "https://www.example.com/waiting-room/"
}
```
### Adding a rate limit

Define a rate limit to avoid an overload. If a request reaches the defined rate limit, it interrupts the request and returns a `429 Too Many Requests` status code.

To do so, add the `key_here` variable while [setting up the Edge Firewall function](#setting-up-the-edge-firewall-function), as follows:

```json
{
  "key": "15"
}
```

If not added to the JSON Args, the default rate limit is `...`.