---
title: Work with Rules Engine
description: Integrate rules in your application to set tasks for specific scenarios without changing your existing code. 
meta_tags: build
namespace: docs_guides_build_work_with_rules_engine
permalink: /documentation/products/guides/build/work-with-rules-engine/
menu_namespace: buildMenu
---

import Button from '~/components/Button.astro'

Implementing rules in your application allow you to determine the tasks it should execute in specific scenarios without modifying your application's code. This guide demonstrates the process of creating rules with some practical examples, but most rules will be unique to each application and its needs.

<Button href="/en/documentation/products/edge-application/rules-engine/" variant="secondary" text="Go to Rules Engine documentation"></Button>

:::caution[warning]
To unlock the full capabilities of Rules Engine, you should activate the [Application Acceleration](/en/documentation/products/edge-application/application-acceleration/) module. If **Application Acceleration** is activated, data transfer could generate usage-related costs. Check the [pricing page](https://www.azion.com/en/pricing/) for more information.
:::

## Via RTM

First, activate the **Application Acceleration** module:

1. [Access RTM](https://manager.azion.com).
2. On the upper-left corner of the page, open the **Products menu**, represented by three horizontal lines, and select **Edge Application**.
3. Click the edge application you want to configure. 
4. Activate the **Application Acceleration** module.
5. Click the **Save** button.

Starting with the request phase, these next steps will help you create a rule that rewrites a request. This way, you can create a rule to deliver content to an end-user from a specific URI without requiring that the exact path from the origin to be present in the request.

When an end-user makes a request to your application for `xxxxxxxxxx.map.azionedge.net/page`, the content that should be delivered instead is from the path `/content/page.html`. To create a rule that will rewrite this request, still on the **Edge Application** page:

1. Navigate to the **Rules Engine** tab.
2. Click the **Add Rule** button.
3. On the dropdown menu, select **Request Phase**.
4. Give your rule a name and, if necessary, a description.
5. In the **Criteria** section, select the `${uri}` variable.
6. As a comparison operator, select **is equal to**.
7. As an argument, add the value `/page`.
8. In the **Behaviors** section, select **Rewrite Request**.
9. As an argument, add `${uri}content/page.html`
10. Click the **Save** button.

As for the response phase, you can create a rule that removes an HTTP header from the response using the **Filter Response Header** behavior. The `Server` header stores information about the server that generated the response. By removing this header, end-users won't receive information about the infrastructure of your application, enhancing your security by reducing the information available to potential attackers.

:::note
Exercise caution when removing any headers from your edge application and ensure that this action doesn't interfere in any applicable standards and guidelines.
:::

1. Navigate to the **Rules Engine** tab.
2. Click the **Add Rule** button.
3. On the dropdown menu, select **Response Phase**.
4. Give your rule a name and, if necessary, a description.
5. In the **Criteria** section, select the `${uri}` variable.
6. As a comparison operator, select **starts with**.
7. As an argument, add the value `/`.
8. In the Behaviors section, select **Filter Response Header**.
9. As an argument, add `Server`.
10. Click the **Save** button.

## Via API

1. Run the following `PATCH` request in your terminal, replacing `[TOKEN VALUE]` with your [personal token](/en/documentation/products/guides/personal-tokens/) and the `<edge_application_id>` variable with [your edge application ID](/en/documentation/products/guides/build/configure-main-settings/) to activate the [Application Acceleration](/en/documentation/products/edge-application/application-acceleration/) module:

```bash
curl --location --request PATCH 'https://api.azionapi.net/edge_applications/<edge_application_id>' \
--header 'Accept: application/json; version=3' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token [TOKEN VALUE]' \
--data '{
    "application_acceleration": true
}'
```

2. You'll receive a response with the updated value.
3. Run the following `POST` request to create a rule in the **Request Phase**, replacing the edge application ID value with the value you received in the previous response:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/request/rules' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
--header 'Content-Type: application/json' \
--data '{
    "name": "RewriteReq /page",
    "behaviors": [
        {
            "name": "rewrite_request",
            "target": "${uri}content/page.html"
        }
    ],
    "criteria": [
        [
            {
                "variable": "${uri}",
                "operator": "is_equal",
                "conditional": "if",
                "input_value": "/page"
            }
        ]
    ]
}'
```

  | Key | Description |
  | --- | --- |
  | `name` | Name of the rule to be created. |
  | `behaviors` | Contains a list of objects with properties that identify behaviors. These objects are composed of `name`, which indicates the name of the behavior, and `target`, which contains the argument for the behavior, if required. |
  | `criteria` | Contains a list of objects with properties that identify criteria.  |
  | `variable` | Sets the variable for the criteria. |
  | `operator` | Determines the comparison being made between the variable and its argument. |
  | `conditional` | Defines how this criteria behaves in relation to others. The first criteria should always carry an `if` value. Subsequent criteria may carry `and` or `or` values. |
  | `input_value` | The value inputted as the argument. May contain another variable, a regex expression, a path or URL depending on the variable being compared. |

4. You'll receive a response similar to this:

```json
{
    "results": {
        "id": <rule_id>,
        "name": "RewriteReq /page",
        "phase": "request",
        "behaviors": [
            {
            "name": "rewrite_request",
            "target": "${uri}content/page.html"
            }
        ],
        "criteria": [
            [
                {
                    "variable": "${uri}",
                    "operator": "is_equal",
                    "conditional": "if",
                    "input_value": "/page"
                }
            ]
        ],
        "is_active": true,
        "order": 1,
        "description": null
    }
}
```

5. Run the following `POST` request to create a rule in the **Response Phase**, replacing the edge application ID value:

```bash
curl --location 'https://api.azionapi.net/edge_applications/<edge_application_id>/rules_engine/response/rules' \
--header 'Accept: application/json; version=3' \
--header 'Authorization: Token [TOKEN VALUE]' \
--header 'Content-Type: application/json' \
--data '{
    "name": "FilterRespHeader Server",
    "behaviors": [
        {
            "name": "filter_response_header",
            "target": "Server"
        }
    ],
    "criteria": [
        [
            {
                "variable": "${uri}",
                "operator": "is_equal",
                "conditional": "if",
                "input_value": "/"
            }
        ]
    ]
}'
```

6. You'll receive the following response:

```json
{
    "results": {
        "id": <rule_id>,
        "name": "FilterRespHeader Server",
        "phase": "response",
        "behaviors": [
            {
                "name": "filter_response_header",
                "target": "Server"
            }
        ],
        "criteria": [
            [
                {
                    "variable": "${uri}",
                    "operator": "is_equal",
                    "conditional": "if",
                    "input_value": "/"
                }
            ]
        ],
        "is_active": true,
        "order": 1,
        "description": null
    }
}
```

7. Wait a few minutes for the changes to propagate.

:::tip
Check the [Azion API documentation](https://api.azion.com/) and the [OpenAPI specification](https://github.com/aziontech/azionapi-openapi/) to know more about all features available via API.
:::
